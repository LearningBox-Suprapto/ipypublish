language: python

matrix:
 include:
    - os: linux
      sudo: required
      python: 2.7
      dist: trusty # required for lates versions of pandoc and latexmk
      env: ALLOW_FAILURE=false
    - os: linux
      sudo: required
      python: 3.6
      dist: trusty
      env: ALLOW_FAILURE=false
    - os: osx
      language: generic
      env: ALLOW_FAILURE=false
      before_install:
        - travis_wait brew update
        - brew install python3
        - virtualenv env -p python3
        - source env/bin/activate
        - brew install pandoc
        - brew upgrade wget
        - travis_retry sudo wget http://mirror.ctan.org/systems/mac/mactex/BasicTeX.pkg -O BasicTeX.pkg
        - sudo installer -pkg BasicTeX.pkg -target /
        - export PATH=$PATH:/usr/texbin:/Library/TeX/texbin
        - travis_retry sudo tlmgr update --self
        - travis_retry sudo tlmgr install latexmk
        - travis_retry sudo tlmgr install adjustbox
        - travis_retry sudo tlmgr install collectbox
        - travis_retry sudo tlmgr install ucs
        - travis_retry sudo tlmgr install enumitem
        - travis_retry sudo tlmgr install placeins
        - travis_retry sudo tlmgr install todonotes
        - travis_retry sudo tlmgr install chngcntr
        - travis_retry sudo tlmgr install doi
        - travis_retry sudo tlmgr install mdframed
        - travis_retry sudo tlmgr install cleveref
        - travis_retry sudo tlmgr install biblatex
      
before_install:
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get -qq update ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y pandoc ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y texlive ; fi
  # required for some styles like adjustbox 
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y texlive-latex-extra ; fi
  - if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then sudo apt-get install -y latexmk ; fi

  - pip install -U pip setuptools wheel  

install:
    - travis_wait pip install -r requirements.txt
    - pip install -r test_requirements.txt
    - pip install .
    - pip install --quiet coverage
    - pip install --quiet coveralls

script:
    - nosetests -v --nocapture --with-doctest --with-coverage --exe --cover-package=ipypublish

after_success:
    - coveralls